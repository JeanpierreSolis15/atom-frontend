<div class="task-form-dialog">
  <div class="dialog-header">
    <h2 mat-dialog-title class="dialog-title">
      <mat-icon class="title-icon">{{ task ? "edit" : "add_task" }}</mat-icon>
      {{ task ? ("COMMON.EDIT" | translate) : ("COMMON.CREATE" | translate) }}
    </h2>
    <button mat-icon-button class="close-button" (click)="onCancel()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <form [formGroup]="taskForm" (ngSubmit)="onSubmit()" class="task-form">
    <mat-dialog-content class="dialog-content">
      <div class="form-section">
        <mat-form-field appearance="outline" class="full-width title-field">
          <mat-label>
            <mat-icon class="field-icon">title</mat-icon>
            {{ "TASK.TITLE" | translate }} *
          </mat-label>
          <input
            matInput
            type="text"
            formControlName="title"
            [placeholder]="'TASK.TITLE' | translate"
            required
            autocomplete="off"
          />
          <mat-error *ngIf="getErrorMessage('title')">
            {{ getErrorMessage("title") }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>
            <mat-icon class="field-icon">description</mat-icon>
            {{ "TASK.DESCRIPTION" | translate }}
          </mat-label>
          <textarea
            matInput
            formControlName="description"
            [placeholder]="'TASK.DESCRIPTION' | translate"
            rows="4"
          ></textarea>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>
            <mat-icon class="field-icon">priority_high</mat-icon>
            {{ "TASK.PRIORITY" | translate }} *
          </mat-label>
          <mat-select formControlName="priority" required>
            <mat-option *ngFor="let option of priorityOptions" [value]="option.value">
              <div class="priority-option">
                <mat-icon [ngClass]="getPriorityIconClass(option.value)">{{ getPriorityIcon(option.value) }}</mat-icon>
                <span>{{ option.label }}</span>
              </div>
            </mat-option>
          </mat-select>
          <mat-error *ngIf="getErrorMessage('priority')">
            {{ getErrorMessage("priority") }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>
            <mat-icon class="field-icon">event</mat-icon>
            {{ "TASK.DUE_DATE" | translate }}
          </mat-label>
          <input
            matInput
            [matDatepicker]="picker"
            formControlName="dueDate"
            [placeholder]="'TASK.DUE_DATE' | translate"
          />
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
      </div>

      <div *ngIf="errorMessage" class="error-message">
        <mat-icon class="error-icon">error</mat-icon>
        <span>{{ errorMessage }}</span>
      </div>
    </mat-dialog-content>

    <mat-dialog-actions align="end" class="dialog-actions">
      <button mat-button type="button" (click)="onCancel()" [disabled]="loading" class="cancel-button">
        <mat-icon>close</mat-icon>
        {{ "COMMON.CANCEL" | translate }}
      </button>
      <button
        mat-raised-button
        color="primary"
        type="submit"
        [disabled]="taskForm.invalid || loading"
        class="submit-button"
      >
        <mat-icon *ngIf="!loading">{{ task ? "check" : "add" }}</mat-icon>
        <mat-spinner *ngIf="loading" diameter="20" class="spinner"></mat-spinner>
        {{
          loading
            ? task
              ? ("KANBAN.UPDATING" | translate)
              : ("KANBAN.CREATING" | translate)
            : task
              ? ("COMMON.UPDATE" | translate)
              : ("COMMON.CREATE" | translate)
        }}
      </button>
    </mat-dialog-actions>
  </form>
</div>
